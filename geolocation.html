<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Geolocation</title>
    <link rel="stylesheet" href="css/jquery.mobile-1.2.0.css" type="text/css" media="all">
    <link rel="stylesheet" href="css/style.css" type="text/css" media="all">
    <script src="js/jquery-1.8.3.min.js"></script>
    <script src="js/jquery.mobile.config.js"></script>
    <script src="js/jquery.mobile-1.2.0.min.js"></script>
    <script src="https://maps.google.com/maps/api/js?sensor=true"></script>
    <script>
        $(document).ready(function(){
            // remove the padding normally found in #content
            $("#content").css("padding", 0);

            // Google Maps stuff
            function displayMap(latitude, longitude){
                var myLatLng = new google.maps.LatLng(latitude, longitude);
                var map = new google.maps.Map(document.getElementById('map'),{
                    zoom:18,
                    center: new google.maps.LatLng(latitude, longitude),
                    mapTypeId:google.maps.MapTypeId.ROADMAP
                });

                var  marker = new google.maps.Marker({
                    map:map,
                    draggable:true,
                    animation: google.maps.Animation.DROP,
                    position: myLatLng
                });
                google.maps.event.addListener(marker, 'click', toggleBounce);

                function toggleBounce() {

                    if (marker.getAnimation() != null) {
                        marker.setAnimation(null);
                    } else {
                        marker.setAnimation(google.maps.Animation.BOUNCE);
                    }
                }
                $("#map").html(map);
            }

            // html5 geolocation api stuff
            function successCallback(position){
                function pad(n){return n<10 ? '0'+n : n}
                var output = '';
                var theDate = '';
                var theTime = '';
                var result = new Date;

                output  = "<div><p>Your position has been located.</p>";
                output += "<p>Latitude: "  + position.coords.latitude  + "°</p>";
                output += "<p>Longitude: " + position.coords.longitude + "°</p>";
                output += "<p>Accuracy: "  + position.coords.accuracy  + " meters</p>";
                if (position.coords.altitude){
                    output += "<p>Altitude: " + position.coords.altitude + " meters</p>";
                }
                if (position.coords.altitudeAccuracy){
                    output += "<p>Altitude Accuracy: " + position.coords.altitudeAccuracy + "meters</p>";
                }
                if (position.coords.heading){
                    output += "<p>Heading: " + position.coords.Heading + "°</p>";
                }
                if (position.coords.speed){
                    output += "<p>Speed: " + position.coords.Speed + " m/s</p>";
                }
                result = new Date(position.timestamp);
                theDate = (result.getMonth()+1)+'-' + result.getDate()+'-' + result.getFullYear();
                theTime = result.getHours()+':' + pad(result.getMinutes())+':' + pad(result.getSeconds());
                output += "<p>Time of Position: " + theDate + " at " + theTime + "</div>";
                //$(output).insertBefore("#map");
                displayMap(position.coords.latitude, position.coords.longitude);
            }

            function errorCallback(error){
                alert("There was a problem getting your location: " + error.message);
            }

            function whereAmI(){
                var geoOptions = {
                    enableHighAccuracy: true,
                    maximumAge: 0,
                    timeout: 45000
                };
                navigator.geolocation.getCurrentPosition(successCallback, errorCallback,
                        geoOptions);
            }


            if (window.navigator.geolocation) {
                whereAmI();
            } else {
                alert("This browser does not natively support geolocation");
            }
        });
    </script>
</head>
<body>
<div id="map-page" data-role="page">
    <header data-role="header">
        <a href="#" data-icon="back" data-rel="back" data-iconpos="notext" title="Go back">Back</a>
        <h1>Your Location</h1>
    </header>
    <div id="content" data-role="content">
        <div id="map">
        </div>
    </div>
</div>
</body>
</html>